---
title: "Untitled"
author: "Chase Baggett"
date: "November 8, 2017"
output: html_document
---

```{r setup, include=FALSE}
library(alr4)
```

#8.1

```{r}
model_1 <- lm(lifeExpF ~ 1,data=UN11)
model_2 <- lm(lifeExpF ~ group,data=UN11)
anova(model_1,model_2)
```
#8.2

One model is not a constrained version of the other model. 

###ADDD MATH####

#8.3
```{r}
model <- lm(lifeExpF ~ group + log(ppgdp) + group:log(ppgdp), data=UN11)
summary(model)
```

#8.4

First, we fit all of the models.
```{r}
model_1 <- lm(Y ~ X1 + I(X1^2) + X2 + I(X2^2) + X1:X2, data = cakes)
model_2 <- lm(formula = Y ~ X1 + I(X1^2) + X2 + I(X2^2), data = cakes)
model_3 <- lm(formula = Y ~ X1 + X2 + I(X2^2) + X1:X2, data = cakes)
model_4 <- lm(formula = Y ~ X2 + I(X2^2), data = cakes)
```

First Test
We reject the null hypothesis due to the .005 P-Value.
```{r}
anova(model_2,model_1)
```

Second Test
We reject the null hypothesis due to the .004 P-Value.
```{r}
anova(model_3,model_1)
```

Third Test
We reject the null hypothesis due to the .0006 P-Value.
```{r}
anova(model_4,model_1)
```

#8.5

LATER

#8.6

LATER

#8.7

```{r}
model_1 <- lm(Y ~ X1 + X2 + I(X1^2) + I(X2^2) + X1:X2, data=cakes)
param.names <- paste("b", 0:5, sep="")
x1.max <- "(b2*b5-2*b1*b4)/(4*b3*b4-b5^2)"
deltaMethod(model_1, x1.max,parameterNames=param.names)
```

#8.8

First let's fit the model and use the built in package. 
```{r}
model <- lm(Y ~ .,data=sniffer)
ncvTest(model)
```

Now we do the math manually and make return the p-value of the fitted model, which matches both the book and the test above. 

```{r}
score_test_fitted_values <- function(model){
  model_summary <-summary(model)
  rss <- residuals(model_summary, type="pearson")
  S.sq <-df.residual(model)*(model_summary$sigma)^2/sum(!is.na(rss))
  U <-(rss^2)/S.sq
  model_U <- lm(U~fitted.values(model))
  df<-1
  SS<-anova(model_U)$"Sum Sq"
  SS_2<-sum(SS)-SS[length(SS)]
  Chisq<-SS_2/2
  if (is.na(df)) {df <- coefficients(model_U)}
  1-pchisq(Chisq, df)
}

#Using the Fitted Values
score_test_fitted_values(model)
```

We can regenerate all the results in the table by changing the model for U. We can see they match the book after accounting for rounding. 

```{r}
score_test <- function(model,formula){
  model_summary <-summary(model)
  rss <- residuals(model_summary, type="pearson")
  S.sq <-df.residual(model)*(model_summary$sigma)^2/sum(!is.na(rss))
  U <-(rss^2)/S.sq
  model_U <- lm(as.formula(formula),data=model$model)
  df <- sum(!is.na(coefficients(model_U))) - 1
  SS<-anova(model_U)$"Sum Sq"
  SS_2<-sum(SS)-SS[length(SS)]
  Chisq<-SS_2/2
  if (is.na(df)) {df <- coefficients(model_U)}
  1-pchisq(Chisq, df)
}


#GasPres
score_test(model,formula="U ~ GasPres")
#TankTemp
score_test(model,formula="U ~ TankTemp")
#TankTemp,GasPres
score_test(model,formula="U ~ TankTemp + GasPres")
#TankTemp,GasTemp,TankPres,GasPres
score_test(model,formula="U ~ TankTemp + GasTemp + TankPres + GasPres")
```
